{% extends '@WebProfiler/Profiler/layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
        <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="-0.016 -0.003 32.031 32.006" enable-background="new -0.016 -0.003 32.031 32.006"><path fill="#EFC75E" d="M9.627 22.319c1.495 1.489 1.945 3.938.451 5.428-1.495 1.489-6.001 3.148-7.496 1.659-1.494-1.489.172-5.979 1.666-7.468 1.495-1.489 3.885-1.109 5.379.381z"/><path fill="#E2574C" d="M23.432 19.008c2.251 4.667-3.242 15.53-5.782 12.456-1.03-1.246-.962-3.234-3.651-5.794-.004.016.979.174 2.13-.868 2.656-2.046 7.303-5.777 7.303-5.794z"/><path fill="#E2574C" d="M13.973 8.556c-5.045-2.286-16.73 3.171-13.4 5.738 1.35 1.041 3.492.984 6.267 3.699-.017.004-.192-.984.926-2.135 2.189-2.658 6.188-7.302 6.207-7.302z"/><path fill="#CF5349" d="M11.751 8.038l-.218-.011c-1.107 1.352-3.812 4.685-5.461 6.794-.676.734-.859 1.401-.898 1.795.323.222.656.478 1 .772.084-.398.305-.953.858-1.554 2.105-2.694 5.948-7.404 5.966-7.403-.377-.18-.801-.303-1.247-.393z"/><path fill="#CF5349" d="M23.463 19.082c-.658.554-4.828 3.973-7.306 5.924-.819.758-1.546.9-1.909.914.356.358.664.705.926 1.04.326.005 1.111-.098 1.997-.917 2.074-1.634 5.322-4.285 6.715-5.436-.075-.552-.213-1.067-.423-1.525z"/><path fill="#D7B354" d="M6.089 21.038c.208.932.847 2.043 1.842 3.036.99.988 2.097 1.624 3.028 1.836.158-1.252-.36-2.623-1.332-3.591-.967-.964-2.307-1.452-3.538-1.281z"/><path fill="#EBEBEB" d="M31.814.16c.752.711-.355 11.267-7.57 18.434-4.467 4.438-7.43 6.156-8.139 6.771-1.961.889-3.262 1.367-7.148-2.495-3.877-3.852-3.131-4.92-2.271-6.765.638-.716 2.405-3.691 6.873-8.13 7.212-7.166 17.468-8.513 18.255-7.815z"/><path fill="#324D5B" d="M22.795 9.163c1.555 1.558 1.555 4.084 0 5.643-1.556 1.558-4.077 1.558-5.633 0-1.555-1.559-1.555-4.085 0-5.643 1.556-1.559 4.077-1.559 5.633 0z"/><path fill="#CCD0D2" d="M21.4 10.577c.784.779.784 2.042 0 2.821-.783.779-2.055.779-2.84 0-.783-.779-.783-2.042 0-2.821.786-.779 2.057-.779 2.84 0z"/></svg>
        </span>
        <strong>{{ collector.domainEvents | length }}</strong>
    {% endset %}

    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>Event Bus</b>
            <span>{{ collector.eventBus | abbr_class }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Published Domain Events</b>
            <span>{{ collector.domainEvents | length }}</span>
        </div>
    {% endset %}

    {{ include('@WebProfiler/Profiler/toolbar_item.html.twig', { link: true }) }}
{% endblock %}

{% block menu %}
    <span class="label {% if collector.domainEvents | length == 0 %}disabled{% endif %}">
        <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="-0.016 -0.003 32.031 32.006" enable-background="new -0.016 -0.003 32.031 32.006"><path fill="#EFC75E" d="M9.627 22.319c1.495 1.489 1.945 3.938.451 5.428-1.495 1.489-6.001 3.148-7.496 1.659-1.494-1.489.172-5.979 1.666-7.468 1.495-1.489 3.885-1.109 5.379.381z"/><path fill="#E2574C" d="M23.432 19.008c2.251 4.667-3.242 15.53-5.782 12.456-1.03-1.246-.962-3.234-3.651-5.794-.004.016.979.174 2.13-.868 2.656-2.046 7.303-5.777 7.303-5.794z"/><path fill="#E2574C" d="M13.973 8.556c-5.045-2.286-16.73 3.171-13.4 5.738 1.35 1.041 3.492.984 6.267 3.699-.017.004-.192-.984.926-2.135 2.189-2.658 6.188-7.302 6.207-7.302z"/><path fill="#CF5349" d="M11.751 8.038l-.218-.011c-1.107 1.352-3.812 4.685-5.461 6.794-.676.734-.859 1.401-.898 1.795.323.222.656.478 1 .772.084-.398.305-.953.858-1.554 2.105-2.694 5.948-7.404 5.966-7.403-.377-.18-.801-.303-1.247-.393z"/><path fill="#CF5349" d="M23.463 19.082c-.658.554-4.828 3.973-7.306 5.924-.819.758-1.546.9-1.909.914.356.358.664.705.926 1.04.326.005 1.111-.098 1.997-.917 2.074-1.634 5.322-4.285 6.715-5.436-.075-.552-.213-1.067-.423-1.525z"/><path fill="#D7B354" d="M6.089 21.038c.208.932.847 2.043 1.842 3.036.99.988 2.097 1.624 3.028 1.836.158-1.252-.36-2.623-1.332-3.591-.967-.964-2.307-1.452-3.538-1.281z"/><path fill="#EBEBEB" d="M31.814.16c.752.711-.355 11.267-7.57 18.434-4.467 4.438-7.43 6.156-8.139 6.771-1.961.889-3.262 1.367-7.148-2.495-3.877-3.852-3.131-4.92-2.271-6.765.638-.716 2.405-3.691 6.873-8.13 7.212-7.166 17.468-8.513 18.255-7.815z"/><path fill="#324D5B" d="M22.795 9.163c1.555 1.558 1.555 4.084 0 5.643-1.556 1.558-4.077 1.558-5.633 0-1.555-1.559-1.555-4.085 0-5.643 1.556-1.559 4.077-1.559 5.633 0z"/><path fill="#CCD0D2" d="M21.4 10.577c.784.779.784 2.042 0 2.821-.783.779-2.055.779-2.84 0-.783-.779-.783-2.042 0-2.821.786-.779 2.057-.779 2.84 0z"/></svg>
        </span>
        <strong>Event Bus</strong>
    </span>
{% endblock %}

{% block panel %}
    <h2>Event Bus</h2>

    {% if collector.domainEvents is empty %}
        <div class="empty">
            <p>No domain events have been published.</p>
        </div>
    {% else %}
        <div class="metrics">
            <div class="metric">
                <span class="value">{{ collector.domainEvents|length }}</span>
                <span class="label">Total published</span>
            </div>
        </div>
        
        <div class="card">
            <strong>Event Bus:</strong> <code>{{ collector.eventBus }}</code>
        </div>

        <h3>Published Domain Events</h3>

        <div>
            <table>
                <thead>
                <tr>
                    <th>Event name</th>
                    <th>Event id</th>
                    <th>Aggregate Id</th>
                    <th>Data</th>
                    <th>Occurred on</th>
                </tr>
                </thead>
                <tbody>
                    {% for event in collector.domainEvents %}
                    <tr>
                        <td class="colored font-normal">{{ event.eventName }}</td>
                        <td class="colored font-normal">{{ event.eventId }}</td>
                        <td class="colored font-normal">{{ event.aggregateId }}</td>
                        <td class="colored font-normal">{{ event.toPrimitives | json_encode }}</td>
                        <td class="colored font-normal">{{ event.occurredOn }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
{% endblock %}